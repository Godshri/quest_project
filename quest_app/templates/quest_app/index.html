{% extends 'quest_app/base.html' %}
{% load static %}

{% block content %}
<div class="start-screen">
    <div class="pixel-welcome">
         <h2>
            <i class="fa-solid fa-gamepad fa-pixel fa-headered fa-blue"></i>
            –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞
            <i class="fa-solid fa-dragon fa-pixel fa-headered fa-orange"></i>
        </h2>
        <div class="pixel-divider"></div>
        
        <div class="game-description">
            <p>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º, –±—É–¥—É—â–∏–π –º–∞—Å—Ç–µ—Ä –∫–æ–¥–∞! <span class="pixel-emoji"></span></p>
        </div>

        <div class="character-selection">
            <h3>–í—ã–±–µ—Ä–∏ —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è:</h3>
            <div class="characters">
                <div class="character selected" data-char="wizard">
                    <i class="fa-solid fa-hat-wizard fa-pixel fa-character fa-blue"></i>
                    <span>–í–æ–ª—à–µ–±–Ω–∏–∫ –ö–æ–¥–∞</span>
                </div>
                <div class="character" data-char="hacker">
                    <i class="fa-solid fa-laptop-code fa-pixel fa-character fa-blue"></i>
                    <span>–•–∞–∫–µ—Ä</span>
                </div>
                <div class="character" data-char="robot">
                    <i class="fa-solid fa-robot fa-pixel fa-character fa-blue"></i>
                    <span>–†–æ–±–æ—Ç-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç</span>
                </div>
            </div>
        </div>

       <a href="{% url 'game' %}" class="pixel-button start-button">
            <i class="fa-solid fa-rocket fa-pixel fa-button fa-orange"></i>
            <span class="button-text">–ù–ê–ß–ê–¢–¨ –ö–í–ï–°–¢</span>
        </a>
        
        <audio id="main-menu-music" loop>
            <source src="{% static 'quest_app/audio/main_menu_music.mp3' %}" type="audio/mpeg">
        </audio>
        
        <audio id="character-select-sound">
            <source src="{% static 'quest_app/audio/character_select.mp3' %}" type="audio/mpeg">
        </audio>
    </div>
</div>

<button id="mute-button" class="pixel-button sound-control-button">üîä</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const characters = document.querySelectorAll('.character');
    const selectSound = document.getElementById('character-select-sound');
    let selectedChar = 'wizard';
    
    characters.forEach(char => {
        char.addEventListener('click', function() {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö
            characters.forEach(c => c.classList.remove('selected'));
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
            this.classList.add('selected');
            selectedChar = this.dataset.char;
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –≤—ã–±–æ—Ä–∞
            if (selectSound) {
                selectSound.currentTime = 0;
                selectSound.play().catch(() => {});
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
            localStorage.setItem('selectedCharacter', selectedChar);
        });
    });
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const savedChar = localStorage.getItem('selectedCharacter');
    if (savedChar) {
        characters.forEach(char => {
            char.classList.remove('selected');
            if (char.dataset.char === savedChar) {
                char.classList.add('selected');
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
                if (selectSound && savedChar !== 'wizard') {
                    setTimeout(() => {
                        selectSound.currentTime = 0;
                        selectSound.play().catch(() => {});
                    }, 300);
                }
            }
        });
    }
});

document.addEventListener('DOMContentLoaded', function() {
    const mainMenuMusic = document.getElementById('main-menu-music');
    const muteButton = document.getElementById('mute-button');
    let isMuted = false;
    
    if (mainMenuMusic) {
        mainMenuMusic.volume = 0.3;
        mainMenuMusic.play().catch(e => {
            console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
        });
    }
    
    if (muteButton) {
        muteButton.addEventListener('click', function() {
            isMuted = !isMuted;
            if (mainMenuMusic) {
                mainMenuMusic.muted = isMuted;
            }
            muteButton.textContent = isMuted ? 'üîá' : 'üîä';
        });
    }
    
    document.addEventListener('click', function() {
        if (mainMenuMusic && mainMenuMusic.paused) {
            mainMenuMusic.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e));
        }
    }, { once: true });
});
</script>
{% endblock %}